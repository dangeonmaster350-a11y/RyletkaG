<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öôÔ∏è –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div class="app">
        <header class="header">
            <h1 class="title">‚öôÔ∏è –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨</h1>
            <button class="profile-btn" onclick="window.location.href='index.html'">üè†</button>
        </header>

        <div class="menu">
            <button class="menu-btn" onclick="showUsers()">
                <span class="emoji">üë•</span>
                <span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
            </button>
            
            <button class="menu-btn" onclick="showWithdrawals()">
                <span class="emoji">üí∞</span>
                <span>–ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥</span>
            </button>
            
            <button class="menu-btn" onclick="showBanUser()">
                <span class="emoji">üî®</span>
                <span>–ó–∞–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
            </button>
            
            <button class="menu-btn" onclick="showGiveGift()">
                <span class="emoji">üéÅ</span>
                <span>–í—ã–¥–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫</span>
            </button>
            
            <button class="menu-btn" onclick="showGiveStars()">
                <span class="emoji">‚≠êÔ∏è</span>
                <span>–í—ã–¥–∞—Ç—å –∑–≤–µ–∑–¥—ã</span>
            </button>
            
            <button class="menu-btn" onclick="showStats()">
                <span class="emoji">üìä</span>
                <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
            </button>
        </div>

        <div id="content" class="content">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</p>
        </div>

        <nav class="bottom-nav">
            <button onclick="window.location.href='index.html'">üè† –ì–ª–∞–≤–Ω–∞—è</button>
            <button onclick="showUsers()">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
            <button onclick="showWithdrawals()">üí∞ –í—ã–≤–æ–¥—ã</button>
            <button onclick="showStats()">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        </nav>
    </div>

    <script>
        const ADMIN_IDS = [123456789]; // –í–∞—à Telegram ID
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
        const tg = window.Telegram.WebApp;
        const userId = tg.initDataUnsafe?.user?.id;
        
        if (!ADMIN_IDS.includes(userId)) {
            alert('‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω!');
            window.location.href = 'index.html';
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ localStorage
        function getAllUsers() {
            const users = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('stars_')) {
                    const userId = key.replace('stars_', '');
                    users.push({
                        id: userId,
                        stars: parseInt(localStorage.getItem(key)),
                        inventory: JSON.parse(localStorage.getItem(`inventory_${userId}`) || '[]')
                    });
                }
            }
            return users;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function showUsers() {
            const users = getAllUsers();
            let html = '<h2>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>';
            
            users.forEach(user => {
                html += `
                    <div style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 10px;">
                        <p><strong>ID:</strong> ${user.id}</p>
                        <p><strong>‚≠êÔ∏è –ó–≤–µ–∑–¥:</strong> ${user.stars}</p>
                        <p><strong>üéÅ –ü–æ–¥–∞—Ä–∫–æ–≤:</strong> ${user.inventory.length}</p>
                        <button class="btn" onclick="banUser('${user.id}')">üî® –ó–∞–±–∞–Ω–∏—Ç—å</button>
                        <button class="btn" onclick="giveStars('${user.id}')">‚≠êÔ∏è –í—ã–¥–∞—Ç—å –∑–≤–µ–∑–¥—ã</button>
                    </div>
                `;
            });
            
            document.getElementById('content').innerHTML = html;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥
        function showWithdrawals() {
            let withdrawals = [];
            
            // –°–±–æ—Ä –≤—Å–µ—Ö –∑–∞—è–≤–æ–∫
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('withdrawals_')) {
                    const userWithdrawals = JSON.parse(localStorage.getItem(key) || '[]');
                    withdrawals = withdrawals.concat(userWithdrawals);
                }
            }
            
            const pendingWithdrawals = withdrawals.filter(w => w.status === 'pending');
            
            let html = '<h2>üí∞ –ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥</h2>';
            
            if (pendingWithdrawals.length === 0) {
                html += '<p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫</p>';
            } else {
                pendingWithdrawals.forEach(w => {
                    const daysLeft = Math.ceil((new Date(w.expiresAt) - new Date()) / (1000 * 60 * 60 * 24));
                    
                    html += `
                        <div style="background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 10px;">
                            <p><strong>ID –∑–∞—è–≤–∫–∏:</strong> ${w.id}</p>
                            <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> @${w.username}</p>
                            <p><strong>–ü–æ–¥–∞—Ä–æ–∫:</strong> ${w.giftEmoji} ${w.giftName}</p>
                            <p><strong>–î–∞—Ç–∞:</strong> ${new Date(w.date).toLocaleDateString()}</p>
                            <p><strong>–û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π:</strong> ${daysLeft}</p>
                            <button class="btn" onclick="approveWithdrawal(${w.id})">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                            <button class="btn btn-secondary" onclick="rejectWithdrawal(${w.id})">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                        </div>
                    `;
                });
            }
            
            document.getElementById('content').innerHTML = html;
        }

        // –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–≤–æ–¥
        function approveWithdrawal(withdrawalId) {
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('withdrawals_')) {
                    let withdrawals = JSON.parse(localStorage.getItem(key) || '[]');
                    const index = withdrawals.findIndex(w => w.id === withdrawalId);
                    
                    if (index !== -1) {
                        withdrawals[index].status = 'approved';
                        localStorage.setItem(key, JSON.stringify(withdrawals));
                        
                        alert('‚úÖ –ó–∞—è–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!');
                        showWithdrawals();
                        return;
                    }
                }
            }
        }

        // –û—Ç–∫–ª–æ–Ω–∏—Ç—å –≤—ã–≤–æ–¥
        function rejectWithdrawal(withdrawalId) {
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('withdrawals_')) {
                    let withdrawals = JSON.parse(localStorage.getItem(key) || '[]');
                    const index = withdrawals.findIndex(w => w.id === withdrawalId);
                    
                    if (index !== -1) {
                        withdrawals[index].status = 'rejected';
                        localStorage.setItem(key, JSON.stringify(withdrawals));
                        
                        alert('‚ùå –ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞!');
                        showWithdrawals();
                        return;
                    }
                }
            }
        }

        // –ó–∞–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function banUser(userId) {
            localStorage.setItem(`banned_${userId}`, 'true');
            alert(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${userId} –∑–∞–±–∞–Ω–µ–Ω`);
            showUsers();
        }

        // –í—ã–¥–∞—Ç—å –∑–≤–µ–∑–¥—ã
        function giveStars(userId) {
            const amount = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥:');
            if (amount) {
                const currentStars = parseInt(localStorage.getItem(`stars_${userId}`) || '0');
                localStorage.setItem(`stars_${userId}`, currentStars + parseInt(amount));
                alert(`‚úÖ –í—ã–¥–∞–Ω–æ ${amount} ‚≠êÔ∏è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${userId}`);
                showUsers();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        function showStats() {
            const users = getAllUsers();
            let totalStars = 0;
            let totalGifts = 0;
            
            users.forEach(user => {
                totalStars += user.stars;
                totalGifts += user.inventory.length;
            });
            
            const html = `
                <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div style="margin: 20px 0;">
                    <p><strong>üë• –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</strong> ${users.length}</p>
                    <p><strong>‚≠êÔ∏è –í—Å–µ–≥–æ –∑–≤–µ–∑–¥:</strong> ${totalStars}</p>
                    <p><strong>üéÅ –í—Å–µ–≥–æ –ø–æ–¥–∞—Ä–∫–æ–≤:</strong> ${totalGifts}</p>
                    <p><strong>‚è≥ –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫:</strong> ${document.querySelectorAll('.pending-withdrawal').length}</p>
                </div>
            `;
            
            document.getElementById('content').innerHTML = html;
        }
    </script>
</body>
</html>